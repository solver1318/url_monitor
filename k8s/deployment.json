{
	"kind": "List",
	"apiVersion": "v1",
	"items": [
		{
    		"apiVersion": "v1",
    		"kind": "Namespace",
    		"metadata": {
        		"name": "url-monitoring"
    		}
		},
		{
			"apiVersion": "apps/v1",
			"kind": "Deployment",
			"metadata": {
				"labels": {
					"app": "urlmon"
				},
				"name": "urlmon"
			},
			"spec": {
				"replicas": 1,
				"selector": {
					"matchLabels": {
						"app": "urlmon"
					}
				},
				"template": {
					"metadata": {
						"labels": {
							"app": "urlmon"
						}
					},
					"spec": {
						"containers": [{
							"command": ["python", "/app/url_mon.py", "8080"],
							"env": [{"name": "CONFIG_PATH", "value": "/config/config.json"}],
							"image": "solver1318/test-image-42:vmware",
							"imagePullPolicy": "IfNotPresent",
							"livenessProbe": {
								"failureThreshold": 5,
								"tcpSocket": {
									"port": 8080
								},
								"initialDelaySeconds": 60,
								"periodSeconds": 10,
								"successThreshold": 1,
								"timeoutSeconds": 5
							},
							"name": "urlmon",
							"ports": [{
								"containerPort": 8080,
								"name": "metrics",
								"protocol": "TCP"
							}],
							"readinessProbe": {
								"failureThreshold": 3,
								"tcpSocket": {
									"port": 8080
								},
								"periodSeconds": 10,
								"successThreshold": 1,
								"timeoutSeconds": 1
							},
							"resources": {
								"limits": {
									"memory": "170Mi",
									"ephemeral-storage": "512Mi"
								},
								"requests": {
									"cpu": "100m",
									"memory": "70Mi",
									"ephemeral-storage": "512Mi"
								}
							},
							"volumeMounts": [{
								"mountPath": "/config",
								"name": "config-volume",
								"readOnly": true
							}]
						}],
						"restartPolicy": "Always",
						"volumes": [{
							"configMap": {
								"defaultMode": 420,
								"name": "urlmon-config"
							},
							"name": "config-volume"
						}]
					}
				}
			}
		},
		{
			"apiVersion": "v1",
			"kind": "Service",
			"metadata": {
				"name": "urlmon-service"
			},
			"spec": {
				"type": "ClusterIP",
				"selector": {
            		"app": "urlmon"
        		},
        		"ports": [
            		{
                		"name": "urlmon",
                		"port": 8080,
                		"protocol": "TCP",
                		"targetPort": 8080
            		}
        		]
			}
		},
		{
			"apiVersion": "v1",
			"kind": "ConfigMap",
			"metadata": {
				"name": "urlmon-config"
			},
			"data": {
              "config.json": "{\"TARGETS\": [\"https://httpstat.us/503\", \"https://httpstat.us/200\"]}\n"
			}
		},
		{
			"apiVersion": "batch/v1beta1",
			"kind": "CronJob",
			"metadata": {
				"name": "client-job"
			},
			"spec": {
				"successfulJobsHistoryLimit": 5,
				"failedJobsHistoryLimit": 5,
				"schedule": "*/1 * * * *",
				"jobTemplate": {
					"spec": {
						"template": {
							"spec": {
								"containers": [
									{
										"name": "client-job",
										"image": "curlimages/curl",
										"args": ["-s", "-XGET", "http://urlmon-service:8080/metrics"]
									}
								],
								"restartPolicy": "OnFailure"
							}
						}
					}
				}
			}
		}
	]
}